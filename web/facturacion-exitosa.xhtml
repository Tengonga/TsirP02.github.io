<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    
    <ui:composition template="template.xhtml">
        <ui:define name="title">#{msg['facturacion.exito.titulo']} - #{msg['app.titulo']}</ui:define>
        
        <ui:define name="styles">
            <style>
                .success-header {
                    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
                    color: white;
                    padding: 40px;
                    border-radius: 15px;
                    margin-bottom: 30px;
                    text-align: center;
                }
                .success-card {
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                    margin-bottom: 20px;
                }
                .success-icon {
                    font-size: 80px;
                    margin-bottom: 20px;
                }
                .summary-item {
                    display: flex;
                    justify-content: space-between;
                    padding: 10px 0;
                    border-bottom: 1px solid #eee;
                }
                .summary-total {
                    display: flex;
                    justify-content: space-between;
                    padding: 15px 0;
                    border-top: 2px solid #667eea;
                    font-size: 18px;
                    font-weight: bold;
                }
                .print-section {
                    border: 2px dashed #667eea;
                    border-radius: 10px;
                    padding: 20px;
                    margin-top: 20px;
                    background: #f8f9fa;
                }
                @media print {
                    .no-print {
                        display: none !important;
                    }
                    .success-card {
                        box-shadow: none;
                        border: 1px solid #ddd;
                    }
                    .success-header {
                        background: #43e97b !important;
                        -webkit-print-color-adjust: exact;
                    }
                }
            </style>
        </ui:define>
        
        <ui:define name="content">
            <div class="success-header">
                <div class="success-icon">‚úÖ</div>
                <h1>#{msg['facturacion.exito.titulo']}</h1>
                <p class="mb-0">
                    #{msg['facturacion.exito.gracias']} 
                    #{facturacionBean.nombre}
                </p>
            </div>
            
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="success-card">
                        <h3 class="mb-4">#{msg['facturacion.exito.resumen']}</h3>
                        
                        <!-- Informaci√≥n del Cliente -->
                        <div class="mb-4">
                            <h5>#{msg['facturacion.info.cliente']}</h5>
                            <div class="summary-item">
                                <span>#{msg['app.nombre']}:</span>
                                <strong>#{facturacionBean.nombre} #{facturacionBean.apellidos}</strong>
                            </div>
                            <div class="summary-item">
                                <span>#{msg['app.tarjeta']}:</span>
                                <strong>**** **** **** #{facturacionBean.ultimosCuatroDigitos}</strong>
                            </div>
                            <!-- ‚úÖ CAMBIO: Fecha de caducidad movida aqu√≠ -->
                            <div class="summary-item">
                                <span>#{msg['app.caducidad']}:</span>
                                <strong>
                                    <h:outputText value="#{facturacionBean.fechaCaducidad}">
                                        <!-- ‚úÖ CAMBIO: Volver a formato MM/yyyy -->
                                        <f:convertDateTime pattern="MM/yyyy"/>
                                    </h:outputText>
                                </strong>
                            </div>
                        </div>
                        
                        <!-- Detalles del Pago -->
                        <div class="mb-4">
                            <h5>#{msg['facturacion.detalles.pago']}</h5>
                            <div class="summary-item">
                                <span>#{msg['facturacion.importe.pagado']}:</span>
                                <strong>
                                    <h:outputText value="#{facturacionBean.importePagado}">
                                        <f:convertNumber type="currency" currencySymbol="‚Ç¨" maxFractionDigits="2"/>
                                    </h:outputText>
                                </strong>
                            </div>
                        </div>
                        
                        <!-- Resumen de Productos -->
                        <div class="mb-4">
                            <h5>#{msg['facturacion.productos.comprados']}</h5>
                            <ui:repeat value="#{carritoBean.productos}" var="item">
                                <div class="summary-item">
                                    <span>#{item.nombre} (#{item.categoria})</span>
                                    <strong>
                                        <h:outputText value="#{item.precio}">
                                            <f:convertNumber type="currency" currencySymbol="‚Ç¨" maxFractionDigits="0"/>
                                        </h:outputText>
                                    </strong>
                                </div>
                            </ui:repeat>
                        </div>
                        
                        <!-- Total de la compra (solo informativo) -->
                        <div class="summary-total">
                            <span>#{msg['app.total']} de la compra:</span>
                            <strong>
                                <h:outputText value="#{carritoBean.total}">
                                    <f:convertNumber type="currency" currencySymbol="‚Ç¨" maxFractionDigits="0"/>
                                </h:outputText>
                            </strong>
                        </div>
                        
                        <!-- Informaci√≥n adicional -->
                        <div class="alert alert-info mt-4">
                            <h6>üìß #{msg['facturacion.confirmacion.enviada']}</h6>
                            <p class="mb-0">
                                #{msg['facturacion.confirmacion.mensaje']}
                            </p>
                        </div>
                        
                        <!-- Secci√≥n de Impresi√≥n -->
                        <div class="print-section text-center no-print">
                            <h5>üñ®Ô∏è #{msg['facturacion.necesitas.copia']}</h5>
                            <p class="mb-3">#{msg['facturacion.imprimir.comprobante']}</p>
                            <button type="button" onclick="window.print()" class="btn btn-primary btn-lg">
                                üñ®Ô∏è #{msg['facturacion.imprimir']}
                            </button>
                        </div>
                        
                        <!-- Botones de acci√≥n -->
                        <div class="text-center mt-4 no-print">
                            <h:form>
                                <h:commandButton value="#{msg['facturacion.nueva.compra']}" 
                                               action="#{facturacionBean.irACategorias}"
                                               styleClass="btn btn-primary btn-lg me-3"/>
                                <h:commandButton value="#{msg['facturacion.ir.inicio']}" 
                                               action="#{facturacionBean.irABienvenida}"
                                               styleClass="btn btn-secondary btn-lg"/>
                            </h:form>
                        </div>
                    </div>
                </div>
            </div>
        </ui:define>
    </ui:composition>
</html>